@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@using UCommerce.Api
@{
    Layout = "mc_store.cshtml";
}

@{
	if (Request.HttpMethod == "POST") {
		int shippingMethodId = Convert.ToInt32(Request.Form["shippingMethod"]);	
		TransactionLibrary.CreateShipment(shippingMethodId, "Shipment",true);
		TransactionLibrary.ExecuteBasketPipeline();
		
		Response.Redirect("payment");
	}
}


@{
	var shippingCountry = TransactionLibrary.GetShipmentInformation().Country;
	var shippingMethods = TransactionLibrary.GetShippingMethods(shippingCountry);

	var shipment = TransactionLibrary.GetBasket().PurchaseOrder.Shipments.FirstOrDefault();
	var selectedShippingMethodId = shipment != null ? shipment.ShippingMethod.ShippingMethodId : 0;
}

<form method="POST">
	@foreach (var shippingMethod in shippingMethods) {
		int shippingMethodId = shippingMethod.ShippingMethodId;
		<input type="radio" name="shippingMethod" value="@shippingMethodId" 
			@(selectedShippingMethodId == shippingMethodId ? "checked" : "")
			/> @shippingMethod.Name
		<br/>
	}

	<input type="submit" value="Continue to payment" />
</form>