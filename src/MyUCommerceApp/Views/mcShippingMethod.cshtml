@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@using UCommerce.EntitiesV2
@using UCommerce.Api
	
@{
	if (IsPost) {
		int shippingMethodId = Convert.ToInt32(Request.Form["shippingMethod"]);	
		TransactionLibrary.CreateShipment(shippingMethodId, "Shipment", true);
		TransactionLibrary.ExecuteBasketPipeline();
		
		Response.Redirect("PaymentMethod");
	}
	
    Layout = "mcMaster.cshtml";
	
	var shippingCountry = TransactionLibrary.GetShipmentInformation().Country;
	var shippingMethods = TransactionLibrary.GetShippingMethods(shippingCountry);
	var shipment = TransactionLibrary.GetBasket().PurchaseOrder.Shipments.FirstOrDefault();
	
	var selectedShippingMethodId = shipment != null ? shipment.ShippingMethod.ShippingMethodId : 0;
}

<form Method="POST">
@foreach (var shippingMethod in shippingMethods) {
	int shippingMethodId = shippingMethod.ShippingMethodId;
	<input 
		type="radio" 
		name="shippingMethod" 
		value="@shippingMethodId" 
		@(selectedShippingMethodId == shippingMethodId ? "checked" : "") /> @shippingMethod.Name
		
}
<input type="submit" value="continue to payment method" />
</form>