@inherits umbraco.MacroEngines.DynamicNodeContext
@using UCommerce.Api

	@{
		if (IsPost) {
		
			int paymentMethodId = Convert.ToInt32(Request.Form["paymentmethod"]);
			
			TransactionLibrary.CreatePayment(paymentMethodId, -1, false, true);
			
			TransactionLibrary.ExecuteBasketPipeline();
			
			Response.Redirect("Preview");
		}
	}
	
	
	@{ 
		var shipmentInformation = TransactionLibrary.GetShipmentInformation();
		var paymentMethods = TransactionLibrary.GetPaymentMethods(shipmentInformation.Country);
		
		var basket = TransactionLibrary.GetBasket().PurchaseOrder;
		
		var payment = basket.Payments.FirstOrDefault();
		
		int selectedPaymentMethodId = payment != null ? payment.PaymentMethod.PaymentMethodId : 0;
	}
<form method="post">
@foreach (var paymentMethod in paymentMethods){
	
	int paymentMethodId = paymentMethod.PaymentMethodId;
	<input type="radio" name="paymentmethod" value="@paymentMethodId" @(selectedPaymentMethodId == paymentMethodId ? "checked" : "") /> @paymentMethod.Name <br/>
}
<input type="submit" value="Review order" />
</form>